<!DOCTYPE html>
<html>
    <head>
        <title>Just an example</title>
        <meta charset="UTF-8">
        <style type="text/css">
            .answer { font-style: italic; border: 1px solid blue; border-radius: 5px; padding: 4px 0;}
            .program-code { display: none; margin-bottom: 30px;  }
            .program-code .title {background-color: #C8DEF4; border: 1px solid #000;}
            .program-code .code { border: 1px solid #000; }
            .program-code .code code { white-space: pre; }
        </style>
        
        <script type="text/javascript" src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
        <script type="text/javascript" src="../lib/flylib.js"></script>
        
        <script id="thisscript" type="text/javascript">
            FL.postData({}, {datatype: 'json'}).setId('first ajax').done(function(data){
                this.stop('stop please', true);
                return FL.postData({}, {datatype: 'script', url: data.name + '.js'}).done(function(){
                    
                    alert('done 1!');
                }, function(){
                    return FL.postData({}, {datatype: 'json', url: 'asd'}).done(function(data){
                        
                        alert('done 1-1!' + JSON.stringify(data));
                    });
                });
            }, function(){
                return FL.postData({}, {datatype: 'json', url: 'asd'}).done(function(data){
                    alert('done 2!' + JSON.stringify(data));
                }).fail(function(err){
                    alert('fail 2!' + JSON.stringify(err));
                });
            }, function(){
                return FL.postData({}, {datatype: 'json', url: 'asd'}).done(function(data){
                    alert('done 3!' + JSON.stringify(data));
                    
                });
            }).then().fail(function(){
                console.log(':::',arguments);
            }).setId('after second ajax').done(function(){
                alert('Request completed successfully!' + JSON.stringify(arguments));
                DEBUG.log(arguments);
            }).fail(function(){
                alert('REquest not completed!' + JSON.stringify(arguments));
                return false;
            }).fail(function(err0){
                alert('Error happened: ' + err0.error);
                console.log(arguments);
            }).anywayThen(function(){
                $('#programcode').show().find('code').html($('#thisscript').html());
                
            }).then(null, function(){
                alert('final promise');
            });
        </script>
    </head>
    <body>
        <div id="programcode" class="program-code">
            <div class="title">Program was completed. Program code is:</div>
            <div class="code"><code></code></div>
        </div>
        <div>Поле снизу будет содержать результат выполнения запроса:</div>
        <div id="answer" class="answer">Загрузка...</div>
    </body>
</html>
